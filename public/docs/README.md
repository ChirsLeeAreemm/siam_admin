# 组件

## 基础组件（base）



用于组件模块的基本功能，监听所有组件的状态，提供安装，启动，停用，编辑，command状态监控，base组件默认安装启动

### 如何安装一个组件

后台组件管理中每一个未安装的组件都会有<安装>按钮

![](img\image-20210510160842585.png)

### 启动

安装后组件状态默认未启动，需要选择启动

### 停用

停用组件

### 编辑

对相应的组件设置运行模块,设置的组件只有在允许的模块下才会运行,下图中 规定了 apiFilter 组件的运行模块

![](img\image-20210510172112377.png)

### command状态监控

可以查看系统内所有支持的命令行说明，以及在线状态（如果有向管理器发送心跳包的话）

![image-20210510172340331](img\image-20210510172340331.png)

规范：所有组件的自定义命令（workerman类）都需要向base管理器发送心跳包

```php

use app\plugs\base\service\PlugsCommandStatus;
use Workerman\Lib\Timer;

Timer::add(1,function (){
    PlugsCommandStatus::ping('插件名');
});
```

------



## Api限流器（apiFilter）



自定义u_id, token, ip 等规则的访问限流，便于saas系统等。

限流统计级别是1秒，1s内超出配置数量值的请求会被拒绝。

### 添加规则

apiFilter组件中可以自由添加限流规则，内置的默认规则如下

| 配置key | 配置数量 |
| :------ | :------- |
| TOTAL   | 30       |

配置key (自定规则)可以如下:

- 120.555.555.11 (IP规则)
- u_id:1(Token限流，带有明确标识的规则，用户ID：1)
- TOTAL:（默认生成，全局限流）

配置数量：默认1s的限流量，1s内超出该值的请求会被拒绝。



------



## 附件管理

adasd

------



## 定时任务面板（cronDoc）

定时任务面板，提供定时任务在线可视化操作

### 声明一个定时任务

-  app
-- cron 目录，为定时任务存放目录
   
创建一个定时任务类，继承同级目录中的 CronBase

可以参考系统自带的两个测试任务 TestCron 、 TestTwoCron

**声明完成后在组件首页列表刷新，会自动识别到新增的定时任务**

![](img\image-20210510173829883.png)


### 查看执行记录

```
任务执行的Log文件路径 ： app\runtime\cron\xxx.log
```

### 在线启动/关闭 任务

在列表<状态>一栏中，可选择在线 开启/关闭 任务的执行 ，这个操作是实时的。

### 复制任务url 

在列表<状态>一栏中，可以点击复制url ，获取任务执行的url

### 如何运行定时任务

有两种方式

- 使用SiamAdmin内置的 cron runner ，开启命令为`php think cron`
- 使用系统级的定时任务，访问任务url

------


## 数据库助手（dbHelper）

提供数据表辅助服务，如：数据表优化，数据表字典等

### 数据表字典（dbDict）

在组件页面中可以直接查看所选择表的字段信息，提高开发过程中数据表对照的效率

![image-20210510174751503](img\image-20210510174751503.png)



### 数据表优化（dbOptimize）

列表中显示数据表的相关信息，提供了优化功能，整理表碎片。

![image-20210510174834505](img\image-20210510174834505.png)

------



## 异常记录（exceptionLogger）

**对异常记录进行可视化**

![image-20210510175100352](img\image-20210510175100352.png)



### 还原查看

还原带有Trace的异常页面，默认使用TP异常模板

用于实现：对外屏蔽错误细节，对内还原错误细节 便于调试排查原因

------



## 站内信（notice）

提供后台站内信息通知

### 发送一条站内信

安装启动该组件后，在send页发送一条站内信

*关于消息类型：*

- 普通：通过进入站内信列表页查看
- 强制：接收者登录时首页强制弹出

![image-20210511092038111](img\image-20210511092038111.png)

### 查看站内信

在页面右上角导航中，如果启动了站内信，则会出现信息图标，可由此进入查看

也可以直接在组件页的 notice 列表页查看

![image-20210511092436584](img\image-20210511092436584.png)

## CURD生成

## 状态码配置

## 请求监控